<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=360">
  <title>Poly-Lang</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <img src="../icons/icon48.png" alt="Poly-Lang" width="24" height="24">
        <span>Poly-Lang</span>
      </div>
      <button id="settingsBtn" class="icon-btn" title="設定">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
        </svg>
      </button>
    </header>

    <!-- Login View -->
    <div id="loginView" class="view">
      <div class="login-content">
        <h2>ログイン</h2>
        <p class="subtitle">Poly-Langアカウントでログインしてください</p>

        <form id="loginForm">
          <div class="form-group">
            <label for="email">メールアドレス</label>
            <input type="email" id="email" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label for="password">パスワード</label>
            <input type="password" id="password" placeholder="パスワード" required>
          </div>
          <button type="submit" class="btn btn-primary" id="loginBtn">
            ログイン
          </button>
        </form>

        <p class="login-hint">
          アカウントをお持ちでない方は<br>
          <a href="https://poly-lang.vercel.app/auth/signup" target="_blank">Poly-Langで登録</a>
        </p>
      </div>
    </div>

    <!-- Main View (logged in) -->
    <div id="mainView" class="view hidden">
      <!-- User Info -->
      <div class="user-info">
        <div class="user-avatar">
          <span id="userInitial">U</span>
        </div>
        <div class="user-details">
          <span id="userName" class="user-name">ユーザー</span>
          <span id="userLang" class="user-lang">日本語 → 英語</span>
        </div>
        <button id="logoutBtn" class="btn btn-small btn-outline">ログアウト</button>
      </div>

      <!-- Quick Save -->
      <div class="section">
        <h3>フレーズを保存</h3>
        <div class="save-box">
          <div class="form-group">
            <label>テキスト（どちらの言語でもOK）</label>
            <textarea id="targetText" placeholder="保存したいフレーズを入力..." rows="2"></textarea>
          </div>
          <div class="form-group translation-group hidden" id="translationGroup">
            <label>翻訳</label>
            <textarea id="translationText" placeholder="翻訳（自動入力されます）" rows="2"></textarea>
          </div>
          <div class="btn-group">
            <button id="smartSaveBtn" class="btn btn-primary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4"/>
              </svg>
              自動検知して保存
            </button>
            <button id="manualBtn" class="btn btn-outline btn-small" title="手動入力モード">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
          </div>
          <div id="manualSaveGroup" class="hidden">
            <button id="saveBtn" class="btn btn-secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
              </svg>
              手動保存
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Phrases -->
      <div class="section">
        <div class="section-header">
          <h3>最近保存したフレーズ</h3>
          <a href="https://poly-lang.vercel.app/app/phrases" target="_blank" class="link-small">すべて見る</a>
        </div>
        <div id="recentPhrases" class="phrases-list">
          <p class="empty-state">保存したフレーズはありません</p>
        </div>
      </div>

      <!-- Usage Tip -->
      <div class="tip">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4M12 8h.01"/>
        </svg>
        <span>Webページでテキストを選択 → ブックマークアイコンをクリックで保存</span>
      </div>
    </div>

    <!-- Settings View -->
    <div id="settingsView" class="view hidden">
      <div class="settings-header">
        <button id="backBtn" class="icon-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <h3>設定</h3>
      </div>

      <div class="settings-content">
        <div class="setting-item">
          <label for="nativeLang">母国語</label>
          <select id="nativeLang">
            <option value="ja">日本語</option>
            <option value="en">English</option>
            <option value="ko">한국어</option>
            <option value="zh">中文</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="learningLang">学習中の言語</label>
          <select id="learningLang">
            <option value="en">English</option>
            <option value="ja">日本語</option>
            <option value="ko">한국어</option>
            <option value="zh">中文</option>
            <option value="fr">Français</option>
            <option value="es">Español</option>
            <option value="de">Deutsch</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
      <div class="spinner"></div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>
  </div>

  <script src="../lib/supabase.js"></script>
  <script src="popup.js"></script>
</body>
</html>
